<?php$style = "";$js = "";$treeconfig = "";$nodeconfig = "";$pc_js = "";$title = "";function downloadpage(){	$token = $_GET['token'];	$type = $_GET['ftype'];	if(isset($token) && isset($type)){$top = <<< EOF<br /><br /><div align="center"><strong><a href="https://client.pstcompliance.com/download.php?token={$token}&type={$type}">Click here to download your file.</a><br /><br />Please be patient as some files are quite large</strong><br /><br />To download individual files for this project please log in below.<div>EOF;}else $top = "";$download = <<< EOF{$top}<br /><br /><form name="login" method="POST" action="?action=authenticate"><table border="0" cellpadding="3" cellspacing="1" style="margin-left:30px;"><tr>	<td colspan="3"><h1 class="header">Client Login</h1></td></tr><tr><td colspan="3">&nbsp;</td></tr><tr>    <td><strong>Username:</strong></td>    <td><input name="username" type="text" id="username" class="input" /></td></tr><tr>    <td><strong>Password:</strong></td>    <td><input name="password" type="password" id="password" class="input" /></td></tr><tr><td colspan="3"><div style="color:red">{$message}&nbsp;</div></td></tr><tr>	<td colspan="3"><input type="submit" name="Submit" value="Login" /></td></tr><tr>	<td colspan="3">&nbsp;</td></tr><tr>	{$pwlink}</tr></table></form><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />EOF;return $download;}function userpage(){	$client = <<< EOF<table width="550" border="0" cellspacing="2" cellpadding="2">  <tr>    <td width="45"><img src="images/icons/Users.png" width="32" height="32" /></td>    <td width="491"><a href="?page=users&type=view">View All Users </a></td>  </tr>  <tr>    <td><img src="images/icons/button-add.png" width="32" height="32" /></td>    <td><a href="?page=users&type=new">Create New User </a></td>  </tr></table>EOF;return $client;	}function viewuserspage(){			global $js, $style;			$js .= <<< EOF		<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>		<script type="text/javascript" src="js/jquery.treeTable.min.js"></script>		<script type="text/javascript" src="js/jquery.cookie.js"></script>		<script type="text/javascript">		$.noConflict();		jQuery(document).ready(function($) {		  $("#tree").treeTable(		  {		  	persist: true,		  	persistCookiePrefix: "treeTableUsers_",		  	{$treeconfig}		  	clickableNodeNames: true			});		{$nodeconfig}		});		</script>EOF;		$style .= <<< EOF		<link href="css/jquery.treeTable.css" rel="stylesheet" type="text/css" />EOF;		$ClientData = get_all_clients();		$table = '<table id="tree" width="600" class="clients">'."\n";		$table .= '<thead>'."\n".'<tr>'."\n".'<th width="350" align="left" >Client Name</th>'."\n".'<th width="200" align="left" >Status</th>'."\n".'<th width="50" align="left" >Options</th>'."\n".'</tr>'."\n".'</thead>'."\n".'<tbody>'."\n";		$r = 1;		$clc = 1;		$table .= '<tr id="node-0" bgcolor="#F5DEB3" >'. "\n";		$table .= '<td width="350" align="left">Administrators</td>'. "\n";		$table .= '<td width="200" align="left"></td>'."\n";		$table .= '<td width="50" align="left"><a href="?page=user&type=new&client=0" title="Create New User"><img src="./images/icons/user-profile-add.png" /></a></td>'. "\n";		$table .= '</tr>'."\n";		$AdminData = get_client_users('0');		while (!$AdminData->EOF) {			if($AdminData->fields[7] == 3){				$usertype = 'Admin';}			if($AdminData->fields[7] == 2){				$usertype = 'Client With Notifications';}			if($AdminData->fields[7] == 1){				$usertype = 'Client Without Notifications';}		$table .= '<tr id="node-0.'.$AdminData->fields[0].'.'.$clc.'" class="child-of-node-0">';		$table .= '<td width="350">'.$AdminData->fields[1].'</td>';		$table .= '<td width="200" align="left">'.$usertype.'</td>'."\n";		$table .= '<td width="50"><a href="?page=user&type=edit&user='.$AdminData->fields[0].'" title="Update User Information"><img src="./images/icons/user-profile-edit.png" /></a> <a href="#" onclick="confirmation(\''.$AdminData->fields[1].'\',\''.$AdminData->fields[0].'\')" title="Delete User"><img src="./images/icons/user-profile-delete.png" /></a></td>';		$table .= '</tr>';				$clc++;				$AdminData->MoveNext();			}				if($ClientData){		while (!$ClientData->EOF) {			if($ClientData->fields[5] == '1'){				$status = 'Active';}			else $status = 'Suspended';		if ($r % 2) {			$rowcolor = "#FAFAD2";			}		else $rowcolor = "#F5DEB3";		$table .= '<tr id="node-'.$ClientData->fields[0].'" bgcolor="'.$rowcolor.'" >'. "\n";		$table .= '<td width="350" align="left">'.$ClientData->fields[1].'</td>'. "\n";		$table .= '<td width="200" align="left">'.$status.'</td>'."\n";		$table .= '<td width="50" align="left"><a href="?page=user&type=new&client='.$ClientData->fields[0].'" title="Create New User"><img src="./images/icons/user-profile-add.png" /></a></td>'. "\n";		$table .= '</tr>'."\n";		$clist = get_client_users($ClientData->fields[0]);				if($clist){		while (!$clist->EOF) {			if($clist->fields[7] == 3){				$usertype = 'Admin';}			if($clist->fields[7] == 2){				$usertype = '<span title="User will receive an email when projects are saved as completed">Client With Notifications</span>';}			if($clist->fields[7] == 1){				$usertype = '<span title="User will not receive email when projects are completed">Client Without Notifications</span>';}		$table .= '<tr id="node-'.$ClientData->fields[0].'.'.$clc.'" class="child-of-node-'.$ClientData->fields[0].'">';		$table .= '<td width="350">'.$clist->fields[1].'</td>';		$table .= '<td width="200" align="left">'.$usertype.'</td>'."\n";		$table .= '<td width="50"><a href="?page=user&type=edit&user='.$clist->fields[0].'" title="Update User Information"><img src="./images/icons/user-profile-edit.png" /></a> <a href="#"  onclick="confirmation(\''.$clist->fields[1].'\',\''.$clist->fields[0].'\')" title="Delete User"><img src="./images/icons/user-profile-delete.png" /></a></td>';		$table .= '</tr>';		$clc++;				$clist->MoveNext();			}		}		$r++;		$ClientData->MoveNext();		}		$table .= '</tbody>'."\n".'</table>'."\n";		$table .= "<script type=\"text/javascript\">						document.observe('dom:loaded', function() {";		$table .= $pc_js;		$table .= '}, false);		</script>';		}		if(isset($_GET['node'])){			$treeconfig = "initialState: 'collapsed',\n		  	persist: false,";			$nodeconfig = '$("#node-'.$_GET['node'].'").toggleBranch();';		}		$table .= '		<script type="text/javascript">function confirmation(username, UserID) {	var answer = confirm("Click OK to delete the user: " + username);	if (answer){		window.location = "?page=user&action=deleteuser&UserID="+UserID;	}}</script>';return $table;}function newuserpage(){	global $style;		$style .= '<link href="css/form.css" rel="stylesheet" type="text/css" />';		$ClientID = $_GET['client'];	if($ClientID == 0){		$authoptions = '<input name="AuthType" type="hidden" value="3" />';}	else $authoptions = <<< EOF<tr><td align="right"><label for="AuthType">User Type:</label></td><td><select name="AuthType">  <option value="2">Client With Notifications</option>  <option value="1">Client Without Notifications</option></select></td></tr>EOF;$newuser = <<< EOF<div align="center"><form method="POST" action="?page=user&type=new&client={$ClientID}&action=newuser" id="customForm"><table border="0" cellpadding="3" cellspacing="1" align="left"><tr><td colspan="2"><h1 class="header">Create New User</h1></td></tr><tr><td colspan="2">&nbsp;</td></tr><tr><td align="right"><label for="FirstName">First Name:</label></td><td><input name="FirstName" type="text" id="FirstName" class="input" value="{$_POST['FirstName']}" /><span id="FirstNameInfo"></span></td></tr><tr><td align="right"><label for="LastName">Last Name:</label></td><td><input name="LastName" type="text" id="LastName" class="input" value="{$_POST['LastName']}" /><span id="LastNameInfo"></span></td></tr><tr><td align="right"><Label for="Email">Email:</label></td><td><input name="Email" type="text" id="Email" class="input" value="{$_POST['Email']}"/><span id="EmailInfo"></span></td></tr><tr><td align="right"><Label for="Username">User Name:</label></td><td><input name="Username" type="text" id="Username" class="input" value="{$_POST['Username']}"/><span id="UsernameInfo"></span></td></tr><tr><td align="right"><Label for="password1">Password:</label></td><td><input name="password1" type="password" id="password1" class="input" /><span id="Password1Info"></span></td></tr><tr><td align="right"><Label for="password2">Confirm Password:</label></td><td><input name="password2" type="password" id="password2" class="input" /><span id="Password2Info"></span></td></tr>{$authoptions}<tr><td colspan="2">&nbsp;</td></tr><tr><td>&nbsp;</td><td><input type="submit" value="Create User" /></td></tr></table><input type="hidden" name="ClientID" value="{$ClientID}" /></form></div><span id="DebugInfo"></span>{$validation_error}<script type="text/javascript" src="/js/jquery-1.6.2.js"></script><script type="text/javascript" src="/js/validator.js"></script>EOF;return $newuser;}function edituserpage(){	$UserID = $_GET['user'];	$uinfo = get_user_info($UserID);	${auth.$uinfo->fields[7]} = 'selected="selected"';	if($uinfo->fields[6] == 0){		$authoptions = '<input name="AuthType" type="hidden" value="3" />';}	else $authoptions = <<< EOF<tr><td align="right"><strong>User Type:</strong></td><td><select name="AuthType">  <option value="2" {$auth2} >Client With Notifications</option>  <option value="1" {$auth1} >Client Without Notifications</option></select></td></tr>EOF;$newuser = <<< EOF<form method="POST" action="?page=user&action=updateuser"><table border="0" cellpadding="3" cellspacing="1"><tr><td><h1 class="header">Update User</h1></td></tr><tr><td colspan="2">&nbsp;</td></tr><tr><td align="right"><strong>First Name:</strong></td><td><input name="FirstName" type="text" id="FirstName" class="input" value="{$uinfo->fields[4]}" /></td></tr><tr><td align="right"><strong>Last Name:</strong></td><td><input name="LastName" type="text" id="LastName" class="input" value="{$uinfo->fields[5]}" /></td></tr><tr><td align="right"><strong>Email:</strong></td><td><input name="Email" type="text" id="Email" class="input" value="{$uinfo->fields[3]}" /></td></tr><tr><td align="right"><strong>User Name:</strong></td><td><input name="Username" type="text" id="Username" class="input" value="{$uinfo->fields[1]}" /></td></tr><tr><td align="right"><strong>Change Password:</strong></td><td><input name="password1" type="password" class="input" id="password1" /></td></tr><tr><td align="right"><strong>Confirm Password:</strong></td><td><input name="password2" type="password" class="input" id="password2" /></td></tr>{$authoptions}<tr><td colspan="2">&nbsp;</td></tr><tr><td>&nbsp;</td><td align="right"><input type="submit" name="Submit" value="Save Profile"></td></tr></table><input type="hidden" name="UserID" value="{$uinfo->fields[0]}" /></form>EOF;return $newuser;}function viewclientspage(){			$clients = get_all_clients();	$viewclients .= '<p><a href="?page=client&type=new"><img src="images/icons/button-add.png" width="32" height="32" style="margin-right:5px;" /></a>';    $viewclients .= '<a href="?page=client&type=new">Create New Client </a></p><hr />';		$viewclients .= '<table width="100%" class="clients">'."\n";        $viewclients .= '<tr><th>Client Name</th><th>Location</th><th>Main Contact</th><th align="center">View</th><th align="center">Edit</th></tr>'."\n";		while(!$clients->EOF){			$viewclients .= '<tr>'."\n";			$viewclients .= '<td>'.htmlspecialchars($clients->fields[1]).'</td>';			$viewclients .= '<td>'.$clients->fields[2].', '.$clients->fields[3].'</td>';			$viewclients .= '<td>'.htmlspecialchars($clients->fields[4]).'</td>';			$viewclients .= '<td align="center"><a href="?page=client&type=overview&id='.$clients->fields[0].'" title="View Client Locations &amp; Checklists"><img src="./images/icons/info.png"></a></td>';			$viewclients .= '<td align="center"><a href="?page=client&type=edit&id='.$clients->fields[0].'" title="Edit Client Information"><img src="./images/icons/user-group-edit.png"></a></td>';			$viewclients .= "\n".'</tr>'."\n";						$clients->MoveNext();		}		$viewclients .= '</table>'."\n";		$viewclients .= '<br /><br /><br /><br /><br /><br /><br /><br /><br />';		$viewclients .= '<br /><br /><br /><br /><br /><br /><br /><br /><br />';		return $viewclients;}function add_q_checklistpage(){		$cat = categories();		if($cat){			$select = '<select name="cat_id">'."\n";		while(!$cat->EOF){			$select .= '<option value="'.$cat->fields[0].'">'.$cat->fields[1].'</option>'."\n";			$cat->MoveNext();		}		$select .= '</select>'."\n";		}$add_q_checklist = <<< EOF<form method="POST" action="?page=checklist&action=addquestion"><table border="0" cellpadding="3" cellspacing="1"><tr><td colspan="2"><h1 class="header">Add Custom Question</h1></td></tr><tr><td colspan="2">&nbsp;</td></tr><tr><td><strong>Category</strong></td><td>{$select}</td></tr><tr><td><strong>Question</strong></td><td><input name="question" type="text" id="question" size="50" maxlength="150" class="input" /></td></tr><tr><td colspan="2">&nbsp;</td></tr><tr><td>&nbsp;</td><td><input type="submit" name="Submit" value="Add Question"></td></tr></table><input type="hidden" name="ChecklistID" value="{$_GET['cl_id']}" /></form>EOF;return $add_q_checklist;}function profilepage() {$profile = <<< EOF<form method="POST" action="?page=profile&action=saveprofile"><table border="0" cellpadding="3" cellspacing="1"><tr><td colspan="3"><h1 class="header">Edit User Profile</h1></td></tr><tr><td colspan="3">&nbsp;</td></tr><tr><td align="right"><strong>First Name:<strong></td><td><input name="firstname" type="text" class="input" id="firstname" value="{$_SESSION['FirstName']}" /></td></tr><tr><td align="right"><strong>Last Name:<strong></td><td><input name="lastname" type="text" id="lastname" class="input" value="{$_SESSION['LastName']}" /></td></tr><tr><td align="right"><strong>Email:<strong></td><td><input name="email" type="text" id="email" class="input" value="{$_SESSION['Email']}" /></td></tr><tr><td align="right"><strong>Change Password:<strong></td><td><input name="password1" type="text" class="input" id="password1" /></td></tr><tr><td align="right"><strong>Confirm Password:<strong></td><td><input name="password2" type="text" class="input" id="password2" /></td></tr><tr><td colspan="3">&nbsp;</td></tr><tr><td colspan="3" align="right"><input type="submit" name="Submit" value="Save Profile"></td></tr></table></form>EOF;return $profile;}function clientpage(){$client = <<< EOF<table width="550" border="0" cellspacing="2" cellpadding="2">  <tr>    <td width="45"><img src="images/icons/Users.png" width="32" height="32" /></td>    <td width="491"><a href="?page=clients&type=view">View All Clients </a></td>  </tr>  <tr>    <td><a href="?page=client&type=new"><img src="images/icons/button-add.png" width="32" height="32" /></a></td>    <td><a href="?page=client&type=new">Create New Client </a></td>  </tr></table>EOF;return $client;}function overviewclientpage(){		global $js, $style;		$style .= <<< EOF		<link href="css/jquery.treeTable.css" rel="stylesheet" type="text/css" />		<link rel="stylesheet" href="css/thickbox.css" type="text/css" media="screen" />		<link rel="stylesheet" href="css/tabcontent.css" type="text/css" />EOF;		$ClientData = get_client_info($_GET['id']);		$clientID = $_GET['id'];		$completed = get_client_locations_status($clientID);		$loc = get_client_locations($clientID);		$r = 1;				$table = '<ul class="tabs" persist="true">';		$table .= '<li><a href="#" rel="view1">Open</a></li>'."\n";		$table .= '<li><a href="#" rel="view2">Completed</a></li>'."\n";		$table .= '</ul>'."\n";		$table .= '<div class="tabcontents">'."\n";		$table .= '<div id="view1" class="tabcontent">'."\n";		if($loc){		$table .= '<table id="tree" width="100%" class="clients">'."\n";        $table .= '<col width="45%" />'."\n";        $table .= '<col width="35%" />'."\n";        $table .= '<col width="20%" />'."\n";		$table .= '<thead>'."\n".'<tr>'."\n".'<th align="left" >Location</th>'."\n".'<th align="left" >Progress</th>'."\n".'<th align="center">Options</th>'."\n".'</tr>'."\n".'</thead>'."\n".'<tbody>'."\n";		$r = 1;		while (!$loc->EOF) {			$viewable = FALSE;		foreach($completed[$loc->fields[0]] as $k => $v){				if($v != 1){					$viewable = TRUE;				}			}		if(!$completed[$loc->fields[0]]){$viewable = TRUE;}		if($viewable === TRUE){		$table .= '<tr id="node-'.$loc->fields[0].'">'. "\n";		$table .= '<td align="left">'.$loc->fields[1].'</td>'. "\n";		$table .= '<td align="left">&nbsp;</td>'."\n";		$table .= '<td align="center"><a href="?page=client&action=newchecklist&location='.$loc->fields[0].'" title="Create New Checklist"><img src="./images/icons/notepad-add.png" ></a> &nbsp;<a href="?page=editlocation&location='.$loc->fields[0].'" title="Edit Location"><img src="./images/icons/marker-edit.png" /></a> &nbsp;<a href="#" onclick="location_confirmation(\''.$loc->fields[0].'\',\''.$loc->fields[1].'\')" title="Delete Location"><img src="./images/icons/marker-delete.png" /></a></td>'. "\n";		$table .= '</tr>'."\n";		}		$clist = get_client_checklist_data($loc->fields[0]);		$clc = 1;		if($clist){		while (!$clist->EOF) {			if($completed[$loc->fields[0]][$clist->fields[0]] != 1){					if ($clc % 2) {					$rowcolor = "#FAFAD2";					}				else $rowcolor = "#F5DEB3";				if(isset($_GET['node']) && isset($_GET['cl_id']) && $_GET['cl_id'] == $clist->fields[0]){					$rowcolor = "#4BB44B";				}					if($clist->fields[2]==1){						$progress = "Completed: ".$clist->fields[3];					}					else $progress = '<span id="element'.$clist->fields[0].'">[ Loading Progress Bar ]</span>';				$table .= '<tr id="node-'.$loc->fields[0].'.'.$clc.'" class="child-of-node-'.$loc->fields[0].'"  bgcolor="'.$rowcolor.'">';				$table .= '<td><a href="?page=checklist&cl_id='.$clist->fields[0].'" >'.$clist->fields[1].'</a></td>';				$table .= '<td align="left">'.$progress.'</td>'."\n";				$table .= '<td align="center"><a href="?page=checklist&type=add_q_&cl_id='.$clist->fields[0].'" title="Create New Question"><img src="./images/icons/form-edit.png" /></a> &nbsp;<a href="include/cl_options.php?cl_id='.$clist->fields[0].'&KeepThis=true&TB_iframe=true&height=400&width=850" class="thickbox" title="Checklist Details" ><img src="./images/icons/settings.png" alt="Checklist Details" /></a> &nbsp;<a href="#" onclick="confirmation(\''.$clist->fields[0].'\',\''.$loc->fields[1].'\')" title="Delete Checklist"><img src="./images/icons/Delete.png" /></a></td>';				$table .= '</tr>'."\n";				$clc++;				$percent_complete = checklist_percent_complete($clist->fields[0]);				if($clist->fields[2]!=1){		$pc_js .= <<< EOF									manualPB{$clist->fields[0]} = new JS_BRAMUS.jsProgressBar(										$('element{$clist->fields[0]}'),										{$percent_complete},										{											animate     : false,											barImage	: Array(												'images/bramus/percentImage_back4.png',												'images/bramus/percentImage_back3.png',												'images/bramus/percentImage_back2.png',												'images/bramus/percentImage_back1.png')});					EOF;						}				}		$clist->MoveNext();			}			$r = 1;		}		$loc->MoveNext();		}		$table .= '</tbody>'."\n".'</table>'."\n";				$table .= '</div>'."\n";				// Create div with closed projects		$table .= '<div id="view2" class="tabcontent">'."\n";		$ClientData = get_client_info($_GET['id']);		$clientID = $_GET['id'];		$completed = get_client_locations_status($clientID);		$loc = get_client_locations($clientID);		$r = 1;		if($loc){		$table .= '<table id="tree2" width="100%" class="clients">'."\n";        $table .= '<col width="45%" />'."\n";        $table .= '<col width="35%" />'."\n";        $table .= '<col width="20%" />'."\n";		$table .= '<thead>'."\n".'<tr>'."\n".'<th align="left" >Location</th>'."\n".'<th align="left" >Progress</th>'."\n".'<th align="center">Options</th>'."\n".'</tr>'."\n".'</thead>'."\n".'<tbody>'."\n";		$r = 1;		while (!$loc->EOF) {			$viewable = FALSE;		foreach($completed[$loc->fields[0]] as $k => $v){			if($v == 1){				$viewable = TRUE;			}		}		if($viewable === TRUE){		$table .= '<tr id="node-'.$loc->fields[0].'">'. "\n";		$table .= '<td align="left">'.$loc->fields[1].'</td>'. "\n";		$table .= '<td align="left">&nbsp;</td>'."\n";		$table .= '<td align="center"><a href="?page=client&action=newchecklist&location='.$loc->fields[0].'" title="Create New Checklist"><img src="./images/icons/notepad-add.png" ></a> &nbsp;<a href="?page=editlocation&location='.$loc->fields[0].'" title="Edit Location"><img src="./images/icons/marker-edit.png" /></a> &nbsp;<a href="#" onclick="location_confirmation(\''.$loc->fields[0].'\',\''.$loc->fields[1].'\')" title="Delete Location"><img src="./images/icons/marker-delete.png" /></a></td>'. "\n";		$table .= '</tr>'."\n";		}		$clist = get_client_checklist_data($loc->fields[0]);		$clc = 1;		if($clist){		while (!$clist->EOF) {			if($completed[$loc->fields[0]][$clist->fields[0]] == 1){					if ($clc % 2) {					$rowcolor = "#FAFAD2";					}				else $rowcolor = "#F5DEB3";				if(isset($_GET['node']) && isset($_GET['cl_id']) && $_GET['cl_id'] == $clist->fields[0]){					$rowcolor = "#4BB44B";				}					if($clist->fields[2]==1){						$progress = "Completed: ".$clist->fields[3];					}					else $progress = '<span id="element'.$clist->fields[0].'">[ Loading Progress Bar ]</span>';				$table .= '<tr id="node-'.$loc->fields[0].'.'.$clc.'" class="child-of-node-'.$loc->fields[0].'"  bgcolor="'.$rowcolor.'">';				$table .= '<td><a href="?page=checklist&cl_id='.$clist->fields[0].'" >'.$clist->fields[1].'</a></td>';				$table .= '<td align="left">'.$progress.'</td>'."\n";				$table .= '<td align="center"><a href="?page=checklist&type=add_q_&cl_id='.$clist->fields[0].'" title="Create New Question"><img src="./images/icons/form-edit.png" /></a> &nbsp;<a href="include/cl_options.php?cl_id='.$clist->fields[0].'&KeepThis=true&TB_iframe=true&height=400&width=850" class="thickbox" title="Checklist Details" ><img src="./images/icons/settings.png" alt="Checklist Details" /></a> &nbsp;<a href="#" onclick="confirmation(\''.$clist->fields[0].'\',\''.$loc->fields[1].'\')" title="Delete Checklist"><img src="./images/icons/Delete.png" /></a></td>';				$table .= '</tr>'."\n";				$clc++;				$percent_complete = checklist_percent_complete($clist->fields[0]);				if($clist->fields[2]!=1){		$pc_js .= <<< EOF									manualPB{$clist->fields[0]} = new JS_BRAMUS.jsProgressBar(										$('element{$clist->fields[0]}'),										{$percent_complete},										{											animate     : false,											barImage	: Array(												'images/bramus/percentImage_back4.png',												'images/bramus/percentImage_back3.png',												'images/bramus/percentImage_back2.png',												'images/bramus/percentImage_back1.png')});					EOF;						}				}		$clist->MoveNext();			}			$r = 1;		}		$loc->MoveNext();		}		$table .= '</tbody>'."\n".'</table>'."\n";		}		$table .= '</div>'."\n";				$table .= "<script type=\"text/javascript\">						document.observe('dom:loaded', function() {";		$table .= $pc_js;		$table .= '}, false);		</script>';		}		if(isset($_GET['node'])){			$treeconfig = "initialState: 'collapsed',\n		  	persist: false,";			$nodeconfig = '$("#node-'.$_GET['node'].'").toggleBranch();';		}					$js .= <<< EOF		<!-- jsProgressBarHandler prerequisites : prototype.js -->	<script type="text/javascript" src="js/prototype/prototype.js"></script>	<!-- jsProgressBarHandler core -->	<script type="text/javascript" src="js/bramus/jsProgressBarHandler.js"></script>		<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>		<script type="text/javascript" src="js/jquery.treeTable.min.js"></script>		<script type="text/javascript" src="js/jquery.cookie.js"></script>		<script type="text/javascript" src="js/cl_options_thickbox.js"></script>		<script type="text/javascript" src="js/tabcontent.js"></script>		<script type="text/javascript">				$.noConflict();		jQuery(document).ready(function($) {		  $("#tree").treeTable(		  {		  	persist: true,		  	persistCookiePrefix: "treeTable{$_GET['id']}_",		  	{$treeconfig}		  	clickableNodeNames: true			}			);					$("#tree2").treeTable(		  {		  	persist: true,		  	persistCookiePrefix: "treeTable2{$_GET['id']}_",		  	{$treeconfig}		  	clickableNodeNames: true			}			);		{$nodeconfig}		}						);				</script><script type="text/javascript">function confirmation(checklist_id, location_code) {	var answer = confirm("Click OK to delete this Checklist for Location Code: " + location_code + 	"?" +  " Deleting a Checklist will delete all associated documents immediately!");	if (answer){		window.location = "?action=deletechecklist&cl_id="+checklist_id;			}}function location_confirmation(location_id, location_code) {	var answer = confirm("Click OK to delete the Location: " + location_code + 	"?" +  " Deleting a Location will delete all associated checklists and documents immediately!");	if (answer){		window.location = "?page=location&action=deletelocation&location="+location_id;			}}</script>		EOF;$overviewclient = <<< EOF<table width="400" class="client_info"><tr><td width="100" valign="top" align="right"><strong>Client:</strong> </td><td>{$ClientData['Name']} <br />{$ClientData['Address']} <br />{$ClientData['City']}, {$ClientData['State']} {$ClientData['Zip']}</td></tr><tr><td colspan="2">&nbsp;</td></tr><tr><td valign="top" align="right"><strong>Main Contact:</strong> </td><td>{$ClientData['Contact']}</td></tr><tr><td valign="top" align="right"><strong>Phone:</strong> </td><td>{$ClientData['Phone']}</td></tr></table><hr><br /><p><a href="?page=location&type=new&client_id={$ClientData['ClientID']}"><img src="images/icons/button-add.png" width="32" height="32" style="margin-left:5px;" /></a><a href="?page=location&type=new&client_id={$ClientData['ClientID']}">Create New Location </a></p><hr />{$table}<br />EOF;return $overviewclient;}function checklistpage(){	global $js, $style;		$checklist_id = GetSQLValueString($_GET['cl_id'], "int");		$percent_complete = checklist_percent_complete($checklist_id);		$js .= <<< EOF	<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>	<script type="text/javascript" src="js/thickbox.js"></script>		<script type="text/javascript">	function clearCheck(lineItem) {		first = "rg_" + lineItem + "_0";		second = "rg_" + lineItem + "_1";		third = "rg_" + lineItem + "_2";		fourth = "rg_" + lineItem + "_3";	document.getElementById(second).checked = false;	document.getElementById(third).checked = false;	document.getElementById(fourth).checked = false;	document.getElementById(first).checked = true;}function confirmation(cid,qid) {	var answer = confirm("Click OK to delete this line item.");	if (answer){		window.location = "?action=deletequestion&cid="+cid+"&qid="+qid	}}	</script>	EOF;		$style .= <<< EOF		<link rel="stylesheet" href="css/thickbox.css" type="text/css" media="screen" />EOF;		$locid = get_location_by_checklist($_GET['cl_id']);		$location = get_location_info($locid);				$table .= "<p><strong>Location Code: ".$location['RefName']."</strong></p>";		$table .= generate_checklist_accordian($checklist_id);		$table .= "<br /><br /><br /><br /><br /><br />";$checklist = <<< EOF{$table}EOF;return $checklist;}function newclientpage(){	$selectstate = show_state_dropdown();$newclient = <<< EOF<form id="form1" name="form1" method="post" action="?action=addclient">  <table border="0" cellspacing="2" cellpadding="2">  <tr>    <td colspan="2"><h1 class="header">Create New User</h1></td>    </tr>    <tr>      <td align="right">Business Name:</td>      <td><input name="BusinessName" type="text" id="BusinessName" class="input" /></td>    </tr>    <tr>      <td align="right">Address:</td>      <td><input name="address" type="text" id="address" class="input" /></td>    </tr>    <tr>      <td align="right">City:</td>      <td><input name="city" type="text" id="city" class="input" /></td>    </tr>    <tr>      <td align="right">State:</td>      <td><select name="state">	{$selectstate}	</select>      </td>    </tr>    <tr>      <td align="right">Zip Code:</td>      <td><input name="zipcode" type="text" id="zipcode" class="input" /></td>    </tr>    <tr>      <td align="right">Phone Number:</td>      <td><input name="phone" type="text" id="phone" class="input" /></td>    </tr>    <tr>      <td align="right">Contact Name:</td>      <td><input name="contact" type="text" id="contact" class="input" /></td>    </tr>    <tr>      <td align="right">Active Client:</td>      <td><input name="active" type="checkbox" id="active" value="1" checked="checked" /></td>    </tr>    <tr><td colspan="2">&nbsp;</td></tr>    <tr>      <td>&nbsp;</td>      <td align="right"><input type="submit" name="Submit" value="Create New Client" /></td>    </tr>  </table></form>EOF;return $newclient;}function editclientpage(){			$clientdata = get_client_info($_GET['id']);		if($clientdata['Active']==1){			$clientactive = 'checked';}		else $clientactive = '';		$stateselect = show_state_dropdown($clientdata['State']);$editclient = <<< EOF<form id="updateclient" name="updateclient" method="post" action="?action=updateclient">  <table border="0" cellspacing="2" cellpadding="2">  	<tr>    <td colspan="2"><h1 class="header">Edit User Information</h1></td>    </tr>    <tr>      <td align="right">Business Name:</td>      <td><input name="Name" type="text" id="Name" class="input" value="{$clientdata['Name']}" /></td>    </tr>    <tr>      <td align="right">Address:</td>      <td><input name="Address" type="text" id="Address" class="input" value="{$clientdata['Address']}" /></td>    </tr>    <tr>      <td align="right">City:</td>      <td><input name="City" type="text" id="City" class="input" value="{$clientdata['City']}" /></td>    </tr>    <tr>      <td align="right">State:</td>      <td><select name="State">		{$stateselect}		</select>      </td>    </tr>    <tr>      <td align="right">Zip Code:</td>      <td><input name="Zip" type="text" id="Zip" class="input" value="{$clientdata['Zip']}" /></td>    </tr>    <tr>      <td align="right">Phone Number:</td>      <td><input name="Phone" type="text" id="Phone" class="input" value="{$clientdata['Phone']}" /></td>    </tr>    <tr>      <td align="right">Contact Name:</td>      <td><input name="Contact" type="text" id="Contact" class="input" value="{$clientdata['Contact']}" /></td>    </tr>    <tr>      <td align="right">Active Client:</td>      <td><input name="Active" type="checkbox" id="Active" value="1" {$clientactive} /></td>    </tr>    <tr><td colspan="2">&nbsp;</td></tr>    <tr>      <td>&nbsp;</td>      <td><input type="submit" name="Submit" value="Update Client Information" /></td>    </tr>  </table>  <input type="hidden" name="ClientID" value="{$clientdata['ClientID']}" /></form>EOF;return $editclient;}function newlocationpage(){	$selectstate = show_state_dropdown();$newlocation = <<< EOF<form id="form1" name="form1" method="post" action="?action=addlocation">  <table border="0" cellspacing="2" cellpadding="2">  <tr>    <td colspan="2"><h1 class="header">Create New Location</h1></td>    </tr>    <tr>      <td align="right">Project Name/Description:</td>      <td><input name="name" type="text" id="name" class="input" /></td>    </tr>    <tr>      <td align="right">Location Code: </td>      <td><input name="location" type="text" id="location" class="input" /></td>    </tr>    <tr>      <td align="right">Address:</td>      <td><input name="address" type="text" id="address" class="input" /></td>    </tr>    <tr>      <td align="right">City:</td>      <td><input name="city" type="text" id="city" class="input" /></td>    </tr>    <tr>      <td align="right">State:</td>      <td><select name="state">	{$selectstate}	</select>      </td>    </tr>    <tr>      <td align="right">Zip Code: </td>      <td><input name="zipcode" type="text" id="zipcode" class="input" /></td>    </tr>    <tr>      <td align="right">Engagement Number: </td>      <td><input name="engagement" type="text" id="engagement" class="input" /> </td>    </tr>    <tr>      <td align="right">Project Drawing Number: </td>      <td><input name="project_drawing_number" type="text" id="project_drawing_number" class="input" /></td>    </tr>    <tr>      <td align="right">AT&amp;T Project Manager: </td>      <td><input name="project_manager" type="text" id="project_manager" class="input" /></td>    </tr>    <tr>      <td align="right">Architect: </td>      <td><input name="architect" type="text" id="architect" class="input" /></td>    </tr>    <tr>      <td align="right">Alliance Contractor or Fuel System Contractor: </td>      <td><input name="af_contractor" type="text" id="af_contractor" class="input" /></td>    </tr>    <tr><td colspan="2">&nbsp;</td></tr>    <tr>      <td>&nbsp;</td>      <td align="right"><input type="submit" name="Submit" value="Create New Location" />      <input type="hidden" name="client_id" value="{$_GET['client_id']}" /></td>    </tr>  </table></form>EOF;return $newlocation;}function editlocationpage(){$data = get_location_info($_GET['location']);$selectstate = show_state_dropdown($data['State']);	$editlocation = <<< EOF<form id="form1" name="form1" method="post" action="?action=editlocation">  <table border="0" cellspacing="2" cellpadding="2">  <tr>    <td colspan="2"><h1 class="header">Edit Location</h1></td>    </tr>    <tr>      <td align="right">Project Name/Description: </td>      <td><input name="name" type="text" id="name" class="input" value="{$data['Name']}"/></td>    </tr>    <tr>      <td align="right">Location Code: </td>      <td><input name="location" type="text" id="location" class="input"  value="{$data['RefName']}"/></td>    </tr>    <tr>      <td align="right">Address:</td>      <td><input name="address" type="text" id="address" class="input"  value="{$data['Address']}"/></td>    </tr>    <tr>      <td align="right">City:</td>      <td><input name="city" type="text" id="city" class="input"  value="{$data['City']}"/></td>    </tr>    <tr>      <td align="right">State:</td>      <td><select name="state">	{$selectstate}	</select>      </td>    </tr>    <tr>      <td align="right">Zip Code: </td>      <td><input name="zipcode" type="text" id="zipcode" class="input"  value="{$data['Zip']}"/></td>    </tr>    <tr>      <td align="right">Engagement Number: </td>      <td><input name="engagement" type="text" id="engagement" class="input"  value="{$data['Engagement']}"/></td>    </tr>    <tr>      <td align="right">Project Drawing Number: </td>      <td><input name="project_drawing_number" type="text" class="input" id="project_drawing_number"  value="{$data['DrawingNumber']}"/></td>    </tr>    <tr>      <td align="right">AT&amp;T Project Manager: </td>      <td><input name="project_manager" type="text" class="input" id="project_manager"  value="{$data['ProjectManager']}"/></td>    </tr>    <tr>      <td align="right">Architect: </td>      <td><input name="architect" type="text" id="architect" class="input"  value="{$data['Architect']}"/></td>    </tr>    <tr>      <td align="right">Alliance Contractor or Fuel System Contractor: </td>      <td><input name="af_contractor" type="text" class="input" id="af_contractor"  value="{$data['AF_Contractor']}"/></td>    </tr>    <tr><td colspan="2">&nbsp;</td></tr>    <tr>      <td>&nbsp;</td>      <td align="right"><input type="submit" name="Submit" value="Edit Location" />      <input type="hidden" name="LocationID" value="{$data['LocationID']}" /></td>    </tr>  </table></form>EOF;return $editlocation;}function topbar(){	if(isset($_SESSION['FirstName'])){$date = date('l, F jS, Y');$topbar = <<< EOF<tr><table width="100%" border="0" cellspacing="2" cellpadding="2"><colgroup>	<col width="30%" />    <col width="40%" />    <col width="30%" /></colgroup>      <tr>        <th scope="row"><div align="left">Welcome {$_SESSION['FirstName']}</div></th>        <th><div align="center">{$date}</div></th>        <th><div align="right"><a href="?action=logout">Logout</a></div></th>      </tr>    </table></tr>EOF;return $topbar;}else return "";}function navbartop(){		$navbar = <<< EOF  <tr>    <td>    <table width="790" border="0" cellspacing="2" cellpadding="2">      <tr>        <td width="135" valign="top">        <ul class="sidelinks">          	<li><a href="?page=dashboard">Search</a></li>          	<li><a href="?page=clients&type=view">Clients</a></li>          	<li><a href="?page=users&type=view">Users</a></li>          	<li><a href="?page=profile">Profile</a></li>        </ul>        </td>        <td width="641" valign="top">&nbsp;EOF;if(isset($_SESSION['FirstName'])){return $navbar;	}else return "";}function navbarend(){		$navbar = <<< EOF	</td>        </tr>    </table>    </td>  </tr>EOF;if(isset($_SESSION['FirstName'])){return $navbar;	}else return "";}function searchbar(){	$dropdown = dropdown_locations();	$searchbar = <<< EOF	  <tr>    <td>	<hr />	<form id="search" name="search" method="post" action="?action=loc_search">	<table width="100%">	<tr>	<td width="70">&nbsp;</td>	<td>	<div align="center">      Location Code:      <input type="text" name="location" class="input" />        <input type="submit" name="Submit" value="Search" />      </div>    </td>    <td width="70">    <div align="right">    {$dropdown}    </div>    </td>    </tr>    </table>    </form>	<hr />    </td>  </tr>EOF;return $searchbar;		}function dashboardpage(){	$blankpage = "";	$dashboard = <<< EOF<table width="800" border="0" cellspacing="2" cellpadding="2">  <tr>    <td><table width="790" border="0" cellspacing="2" cellpadding="2">      <tr>        <th width="230" scope="row"><div align="left">Welcome {$_SESSION['FirstName']}, </div></th>        <th width="344"><div align="center">{$date}</div></th>        <th width="196"><div align="right"><a href="?action=logout">Logout</a></div></th>      </tr>    </table></td>  </tr>  <tr>    <td>	<hr />	<div align="center">	<form id="search" name="search" method="post" action="?action=loc_search">      Location Code      <input type="text" name="location" />        <input type="submit" name="Submit" value="Search" />    </form>    </div>	<hr />    </td>  </tr>  <tr>    <td><table width="790" border="0" cellspacing="2" cellpadding="2">      <tr>        <tr width="135" valign="top"><div align="left">          <p><a href="?page=dashboard">Search</a></p>          <p><a href="?page=client">Clients</a></p>          <p><a href="?page=user">Users</a></p>          <p><a href="?page=profile">Profile</a></p>        </div></tr>        <td width="641" valign="top">&nbsp;</td>        </tr>    </table></td>  </tr></table>EOF;return $blankpage;}function homepage(){	$GLOBALS['title'] = "PST Compliance";$home = <<< EOFEOF;return $home;}function loginpage(){	$message = "";	if(isset($_GET['error'])){		if($_GET['error'] == "authfail"){		$message = "Invalid Username or Password";			}	}$login = <<< EOF<br /><br /><form name="login" method="POST" action="?action=authenticate"><table border="0" cellpadding="3" cellspacing="1" style="margin-left:30px;"><tr>	<td colspan="3"><h1 class="header">Client Login</h1></td></tr><tr><td colspan="3">&nbsp;</td></tr><tr>    <td><strong>Username:</strong></td>    <td><input name="username" type="text" id="username" class="input" /></td></tr><tr>    <td><strong>Password:</strong></td>    <td><input name="password" type="password" id="password" class="input" /></td></tr><tr><td colspan="3">{$message}&nbsp;</td></tr><tr>	<td colspan="3"><input type="submit" name="Submit" value="Login" /></td></tr></table></form><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />EOF;return $login;}function searchresultspage() {	global $search_results;		if($search_results->RecordCount() == 0){		$html = <<< EOF		<div align="center">No Matches Found<br /><a href="?page=dashboard">Click here to search again</a></div>EOF;	}	else{		$html = <<< EOF<table width="100%" class="clients"><tr><th>Client</th><th>Project Name</th><th>Location Code</th><th>City</th><th>State</th><th>Date</th><th>&nbsp;</th></tr>EOF;while(!$search_results->EOF){	$checklist_id = $search_results->fields[5];	$client = $search_results->fields[8];	$client_id = $search_results->fields[6];	$location_id = $search_results->fields[0];	$location_code = $search_results->fields[1];	$location_name = $search_results->fields[2];	$city = $search_results->fields[3];	$state = $search_results->fields[4];	$date = $search_results->fields[7];	$completed = $search_results->fields[9];		if($completed == 1){		$link = "<a href=\"?page=client&type=overview&id={$client_id}&cl_id={$checklist_id}&node={$location_id}#view2\"><img src=\"./images/icons/info.png\" /></a>";	}	else {		$link = "<a href=\"?page=client&type=overview&id={$client_id}&cl_id={$checklist_id}&node={$location_id}#view1\"><img src=\"./images/icons/info.png\" /></a>";	}	$html .= <<< EOF<tr><td>{$client}</td><td>{$location_name}</td><td>{$location_code}</td><td>{$city}</td><td>{$state}</td><td>{$date}</td><td>{$link}</td></tr>EOF;$search_results->MoveNext();}$html .= '</table>'; 	}	return $html;}$body_onload = <<< EOF onload="MM_preloadImages('images/1_on.png','images/2_on.png','images/3_on.png','images/4_on.png')"EOF;$style .= <<< EOF<link href="css/styles.css" rel="stylesheet" type="text/css" />EOF;$js .= <<< EOF<script type="text/javascript"><!--function MM_findObj(n, d) { //v4.01  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);  if(!x && d.getElementById) x=d.getElementById(n); return x;}//--></script><script type="text/javascript">function MM_swapImgRestore() { //v3.0  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;}function MM_preloadImages() { //v3.0  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}}function MM_swapImage() { //v3.0  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}}//--></script>EOF;$footer = <<< EOF<div id="footer"><a href="http://www.pstcompliance.com/index.html">Home</a> &bull; <a href="http://www.pstcompliance.com/site-inspections-fuel-system-removals-dallas-fort-worth-arlington-texas.html">Services</a> &bull; <a href="https://client.pstcompliance.com">Client Login</a> &bull; <a href="http://www.pstcompliance.com/pst-compliance-dallas-fort-worth-arlington-texas.php">Contact Us</a><br /><a href="http://www.webworkscorp.com/" target="_blank">Web design and hosting brought to you by Web Works</a></div>EOF;?>